<extend name="Public/base"/>
<block name="style">
    <css href="__JS__/jquery.icheck/skins/square/blue.css"/>
    <css href="__JS__/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
    <style type="text/css">
        .col-sm-3{
            width:185px;
        }
        .blue {
            table-layout:fixed;
        }
        .blue  td {
            word-wrap:break-word;
        }
    </style>
</block>

<block name="body">
    <div>
        <div class="page-head">
            <h2>开奖订单</h2>
        </div>
        <div class="cl-mcont">
            <div class="row">
                <div class="col-md-12">
                    <form class="shop-form" method="get" action="{:U('lotterylist')}">
                        <div class="block-flat">
                            <div class="header">
                                <h3 class="hthin">{$meta_title}</h3>
                            </div>
                        </div>

                        <div class="content">
                            <div class="col-sm-12">
                                <div style="float: left;width: 100%;margin-bottom:15px;">
                                    <input type="hidden" value="{$pid}" name="pid"/>
                                    <label class="pull-left control-label">开始日期</label>
                                    <div class="col-sm-3">
                                        <div class="input-group date starttime" data-min-view="2" data-date-format="yyyy-mm-dd">
                                            <input type="text" name="starttime" class="form-control" value="{$Think.post.starttime|default=time_format(NOW_TIME-24*60*60*30,'Y-m-d')}"/>
                                            <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
                                        </div>
                                    </div>
                                    <label class="pull-left control-label">结束日期</label>
                                    <div class="col-sm-3" >
                                        <div class="input-group date endtime" data-min-view="2" data-date-format="yyyy-mm-dd">
                                            <input type="text" name="endtime" class="form-control" value="{$Think.post.endtime|default=time_format(NOW_TIME,'Y-m-d')}"/>
                                            <span class="input-group-addon btn btn-primary" ><span class="glyphicon glyphicon-th"></span></span>
                                        </div>
                                    </div>

                                    <label class="pull-left control-label">采购平台</label>
                                    <div class="col-sm-3" >
                                        <select name="suppliersname" class="form-control" style="width: 150px;">
                                        <option value="">所有采购平台</option>
                                        <volist name="suppliers" id="vo">
                                            <option value="{$vo.suppliername}">{$vo.suppliername}</option>
                                        </volist>
                                            </select>
                                    </div>
                                    <if condition="($role_status eq 0)">
                                    <label class="pull-left control-label">商品类型状态</label>
                                    <div class="col-sm-3" >
                                        <select class="form-control" name="shopstatus" style="width: 150px;">
                                            <option value="">所有类型状态</option>
                                            <option value="2">金袋</option>
                                            <option value="1">非金袋</option>
                                        </select>
                                    </div>
                                </if>
                                </div>
                                <div>
                                    <label class="pull-left control-label">物流状态</label>
                                    <div class="col-sm-3" >
                                        <select class="form-control" name="order_status" style="width: 150px;">
                                            <option value="">物流状态</option>
                                            <option value="100">未发货</option>
                                            <option value="101">已发货</option>
                                            <option value="102">已收货</option>
                                        </select>
                                    </div>
                                    <label class="pull-left control-label">夺宝类型</label>
                                    <div class="col-sm-3">
                                        <select name="iscommon" class="form-control" style="width: 150px;">
                                            <option value="">所有类型</option>
                                            <option value="1">普通摸金</option>
                                            <option value="2">PK摸金</option>
                                        </select>
                                    </div>
                                    </div>
                                    <label class="pull-left control-label">房间号</label>
                                    <div class="col-sm-3" >
                                        <input type="text" name="house_no" class="form-control">
                                    </div>
                                    <label class="pull-left control-label">商品名称</label>
                                    <div class="col-sm-3">
                                        <input type="text" name="keyword" class="form-control">
                                    </div>
                                    <div class="col-sm-3">
                                        <button type="button" id="search"
                                                url="{:U('lotterylist')}" class="btn btn-success">
                                            搜索
                                        </button>
                                        <button type="button"   url="{:U('exportlotterylist')}"  class="btn btn-success" id="btnExport">导出</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <table class="no-border blue">
                            <thead class="no-border">
                            <tr>
                                <th style="width:10%;">订单号</th>
                                <th style="width:5%;">期号</th>
                                <th style="width:5%;">商品ID</th>
                                <th style="width:10%;">商品名称</th>
                                <th style="width:5%;">是否实物</th>
                                <th style="width:5%;">虚拟卡号</th>
                                <th style="width:5%;">总支付金额（单位：元）</th>
                                <th style="width:5%;">现金支付金额（单位：元）</th>
                                <th style="width:5%;">开奖时间</th>
                                <th style="width:5%;">中奖号码</th>
                                <th style="width:5%;">用户ID</th>
                                <th style="width:5%;">中奖用户</th>
                                <th style="width:5%;">采购平台</th>
                                <th style="width:5%;">采购订单号</th>
                                <th style="width:5%;">采购订单状态</th>
                                <th style="width:5%;">采购订单物流状态</th>
                                <th style="width:5%;">采购订单实际金额（单位：元）</th>
                                <th style="width:5%;">采购订单预估价（单位：元）</th>
                                <th style="width: 5%">类型</th>
                                <th style="width: 5%">房间号</th>
                                <!--<th class="text-right">操作</th>-->
                            </tr>
                            </thead>
                            <notempty name="shoplist">
                                <tbody class="no-border-y">
                                <volist name="shoplist" id="vo">
                                    <tr>
                                        <!--订单号-->
                                        <td>{$vo['orderno']}</td>
                                        <td>{$vo['no']}</td>
                                        <td>{$vo['shopid']}</td>
                                        <td>{$vo['name']}</td>
                                        <td >{$vo['fictitious']==2?"虚拟":"实物"}</td>
                                        <td>{$vo['cardno']}</td>
                                        <td>{$vo['gold']+$vo['cash']}</td>
                                        <td>{$vo['cash']}</td>
                                        <td >{$vo.kaijang_time|time_format=###,"Y-m-d H:i:s"}</td>
                                        <td >{$vo['kaijang_num']}</td>
                                        <td >{$vo['userid']}</td>
                                        <td >{$vo['username']}</td>
                                        <td>{$vo['suppliername']}</td>
                                        <td >{$vo['purchaseno']}</td>
                                        <td >{:purchaseorderstatus($vo['purchaseorderstatus'])}</td>
                                        <td >{:get_order_status($vo['order_status'])}</td>
                                        <td >{$vo['purchasecash']}</td>
                                        <td>{$vo['buy_price']}</td>
                                        <td><if condition="$vo['iscommon'] eq 2">PK摸金<else />普通摸金</if></td>
                                            <td>{$vo['house_no']}</td>
                                        <!--<td class="text-right">-->
                                            <!--<a href="{:U('Finance/orderdetail?display=1&pid='.$vo['pid'].'&orderid='.$vo['order_id'])}" >查看流水</a>-->
                                            <!--&lt;!&ndash;<a href="{:U('Order/orderdetail?display=0&pid='.$vo['pid'].'&orderid='.$vo['order_id'])}" >发货</a>&ndash;&gt;-->
                                        <!--</td>-->
                                    </tr>
                                </volist>
                                </tbody>
                                <else/>
                                <td colspan="3"> aOh! 暂时还没有内容!</td>
                            </notempty>
                        </table>

                        <div class="content col-lg-12 pull-left">
                            <div class="panel-foot text-center">
                                <div class="page">{$_page}</div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                </div>
                </form>
            </div>
        </div>
    </div>
    </div>
    </div>
</block>
<block name="script">
    <js href="__JS__/jquery.icheck/icheck.min.js"/>
    <js href="__JS__/bootstrap.datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" />
    <script type="text/javascript">
        $(document).ready(function () {
            $(".starttime").datetimepicker({autoclose: true,language: 'zh-CN'});
            $(".endtime").datetimepicker({autoclose: true,language: 'zh-CN'});

            highlight_subnav('{:U('Finance/lotterylist')}');
            $('.opiframe').click(function () {
                layer.open({
                    type: 2,
                    title: $(this).attr('data-name'),
                    shadeClose: true,
                    maxmin: false, //开启最大化最小化按钮
                    area: ['850px', '610px'],
                    content: [$(this).attr('url'), 'no']
                });
            });
            //搜索功能
            $("#search").click(function () {
                var role_status = "{$role_status}";//是否是财务 0否 1是
                var url = $(this).attr('url');
                var keyword=  $('input[name=keyword]').val();
                var suppliersname=  $("select[name=suppliersname]").val();
                var order_status=    $("select[name=order_status]").val();
                var starttime=  $('input[name=starttime]').val();
                var endtime=    $('input[name=endtime]').val();
                var shopstatus = $('select[name=shopstatus]').val();
                var iscommon=  $("select[name=iscommon]").val();
                var houseno=    $('input[name=house_no]').val();
                var   query="keyword/"+keyword+"/order_status/"+order_status+"/suppliersname/"+suppliersname+"/starttime/"+starttime+"/endtime/"+endtime+"/iscommon/"+iscommon+"/houseno/"+houseno;
                if (role_status==0) {
                    query += '/shopstatus/'+shopstatus;
                }
                url += '/' + query;
                window.location.href = url;
            });

            //导出功能
            $("#btnExport").click(function () {
                var role_status = "{$role_status}";//是否是财务 0否 1是
                var url = $(this).attr('url');
                var keyword=  $('input[name=keyword]').val();

                var suppliersname=  $("select[name=suppliersname]").val();
                var order_status=    $("select[name=order_status]").val();
                var starttime=  $('input[name=starttime]').val();
                var endtime=    $('input[name=endtime]').val();
                var shopstatus = $('select[name=shopstatus]').val();
                var iscommon=  $("select[name=iscommon]").val();
                var houseno=    $('input[name=house_no]').val();
                var   query="keyword/"+keyword+"/order_status/"+order_status+"/suppliersname/"+suppliersname+"/starttime/"+starttime+"/endtime/"+endtime+"/iscommon/"+iscommon+"/houseno/"+houseno;
                if (role_status==0) {
                    query += '/shopstatus/'+shopstatus;
                }
                url += '/' + query;
                window.location.href = url;
            });

            shopIndx.conditionarr();
        });

        var shopIndx = {
            conditionarr: function () {
                var conditionarr =  JSON.parse('{$conditionarr}') ;
                $('input[name=keyword]').val(  conditionarr['keyword']);
                $("input[name=starttime]").val(conditionarr['starttime']);
                $("input[name=endtime]").val(conditionarr['endtime']);
                $("select[name=suppliersname]").val(conditionarr['suppliersname']);
                $("select[name=order_status]").val(conditionarr['order_status']);
                $("select[name=shopstatus]").val(conditionarr['shopstatus']);
                $("select[name=iscommon]").val(conditionarr['iscommon']);
                $('input[name=house_no]').val(  conditionarr['houseno']);
            }
        }

    </script>
</block>